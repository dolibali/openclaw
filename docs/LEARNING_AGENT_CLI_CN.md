# Agent å’Œ CLI åŠŸèƒ½å­¦ä¹ æŒ‡å—

æœ¬æŒ‡å—ä¸“é—¨é’ˆå¯¹ Moltbot çš„ Agent å’Œ CLI åŠŸèƒ½å®ç°ï¼Œåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š
- **å¿«é€Ÿå­¦ä¹ ï¼ˆ1å¤©ï¼‰**: ç†è§£æ ¸å¿ƒæµç¨‹å’Œå…³é”®ä»£ç 
- **æ·±å…¥å­¦ä¹ ï¼ˆ1å‘¨ï¼‰**: æ·±å…¥æ¯ä¸ªæ¨¡å—çš„å®ç°ç»†èŠ‚

## å¿«é€Ÿå­¦ä¹ ï¼ˆ1å¤©ï¼‰- æ ¸å¿ƒæµç¨‹ç†è§£

### ç›®æ ‡
åœ¨ä¸€å¤©å†…ç†è§£ Agent å’Œ CLI çš„æ ¸å¿ƒå·¥ä½œæµç¨‹ï¼Œèƒ½å¤Ÿè¿½è¸ªä»£ç æ‰§è¡Œè·¯å¾„ã€‚

### æ—¶é—´åˆ†é…ï¼ˆ8å°æ—¶ï¼‰

#### ç¬¬1å°æ—¶ï¼šCLIå…¥å£å’Œå‘½ä»¤è·¯ç”±

**å­¦ä¹ æ–‡ä»¶**:
1. `moltbot.mjs` - CLIå…¥å£ç‚¹
2. `src/entry.ts` - å…¥å£å¤„ç†é€»è¾‘
3. `src/cli/run-main.ts` - CLIä¸»å‡½æ•°
4. `src/cli/route.ts` - å‘½ä»¤è·¯ç”±
5. `src/cli/program.ts` - ç¨‹åºæ„å»º

**å…³é”®æ¦‚å¿µ**:
- CLIå¦‚ä½•å¯åŠ¨å’Œåˆå§‹åŒ–
- å‘½ä»¤å¦‚ä½•è¢«è§£æå’Œè·¯ç”±
- Commander.jsçš„ä½¿ç”¨æ–¹å¼

**å®è·µ**:
```bash
# è¿è¡Œä¸€ä¸ªç®€å•å‘½ä»¤ï¼Œè¿½è¸ªæ‰§è¡Œè·¯å¾„
pnpm moltbot --help
pnpm moltbot agent --help
```

**æ£€æŸ¥ç‚¹**:
- [ ] ç†è§£ `moltbot.mjs` å¦‚ä½•è°ƒç”¨ `src/entry.ts`
- [ ] ç†è§£ `runCli` å‡½æ•°å¦‚ä½•æ„å»ºç¨‹åº
- [ ] ç†è§£å‘½ä»¤æ³¨å†Œæœºåˆ¶ï¼ˆ`commandRegistry`ï¼‰

---

#### ç¬¬2å°æ—¶ï¼šAgentå‘½ä»¤å…¥å£

**å­¦ä¹ æ–‡ä»¶**:
1. `src/commands/agent.ts` - Agentå‘½ä»¤ä¸»å‡½æ•°
2. `src/commands/agent-via-gateway.ts` - é€šè¿‡Gatewayæ‰§è¡ŒAgent
3. `src/cli/program/command-registry.ts` - å‘½ä»¤æ³¨å†Œè¡¨

**å…³é”®æ¦‚å¿µ**:
- Agentå‘½ä»¤çš„å‚æ•°è§£æ
- æœ¬åœ°æ‰§è¡Œ vs Gatewayæ‰§è¡Œçš„åŒºåˆ«
- ä¼šè¯è§£æé€»è¾‘

**å®è·µ**:
```bash
# è¿è¡Œagentå‘½ä»¤ï¼Œè§‚å¯Ÿæ‰§è¡Œæµç¨‹
pnpm moltbot agent --message "Hello" --agent main
```

**æ£€æŸ¥ç‚¹**:
- [ ] ç†è§£ `agentCommand` å‡½æ•°çš„å‚æ•°ç»“æ„
- [ ] ç†è§£ `agentViaGatewayCommand` å¦‚ä½•è°ƒç”¨Gateway
- [ ] ç†è§£ä¼šè¯å¦‚ä½•è¢«è§£æï¼ˆ`resolveSession`ï¼‰

---

#### ç¬¬3å°æ—¶ï¼šAgentè¿è¡Œæ—¶æ ¸å¿ƒ

**å­¦ä¹ æ–‡ä»¶**:
1. `src/agents/pi-embedded.ts` - åµŒå…¥å¼Pi Agentè¿è¡Œå™¨
2. `src/agents/pi-embedded-runner.ts` - Agentè¿è¡Œé€»è¾‘
3. `src/agents/cli-runner.ts` - CLIåç«¯è¿è¡Œå™¨

**å…³é”®æ¦‚å¿µ**:
- Pi Agentå¦‚ä½•è¢«åµŒå…¥å’Œè°ƒç”¨
- RPCé€šä¿¡æœºåˆ¶
- å·¥å…·è°ƒç”¨çš„æ¡¥æ¥

**å®è·µ**:
```bash
# æŸ¥çœ‹agentè¿è¡Œæ—¶çš„æ—¥å¿—
pnpm moltbot agent --message "What tools do you have?" --verbose on
```

**æ£€æŸ¥ç‚¹**:
- [ ] ç†è§£ `runEmbeddedPiAgent` å¦‚ä½•å¯åŠ¨Agent
- [ ] ç†è§£å·¥å…·å¦‚ä½•è¢«æ³¨å†Œå’Œè°ƒç”¨
- [ ] ç†è§£ä¼šè¯å†å²å¦‚ä½•ç®¡ç†

---

#### ç¬¬4å°æ—¶ï¼šGatewayé€šä¿¡

**å­¦ä¹ æ–‡ä»¶**:
1. `src/gateway/call.ts` - Gatewayè°ƒç”¨å°è£…
2. `src/commands/agent-via-gateway.ts` - Gateway Agentè°ƒç”¨
3. `src/cli/gateway-rpc.ts` - Gateway RPCå®¢æˆ·ç«¯

**å…³é”®æ¦‚å¿µ**:
- WebSocketè¿æ¥ç®¡ç†
- Gatewayåè®®æ ¼å¼
- è¯·æ±‚/å“åº”å¤„ç†

**å®è·µ**:
```bash
# å¯åŠ¨Gatewayï¼Œç„¶åé€šè¿‡CLIè°ƒç”¨
pnpm gateway:watch
# åœ¨å¦ä¸€ä¸ªç»ˆç«¯
pnpm moltbot agent --message "Hello" --agent main
```

**æ£€æŸ¥ç‚¹**:
- [ ] ç†è§£ `callGateway` å¦‚ä½•å»ºç«‹è¿æ¥
- [ ] ç†è§£Gatewayåè®®çš„æ¶ˆæ¯æ ¼å¼
- [ ] ç†è§£è¶…æ—¶å’Œé”™è¯¯å¤„ç†

---

#### ç¬¬5å°æ—¶ï¼šä¼šè¯ç®¡ç†

**å­¦ä¹ æ–‡ä»¶**:
1. `src/commands/agent/session.ts` - ä¼šè¯è§£æ
2. `src/config/sessions.ts` - ä¼šè¯å­˜å‚¨
3. `src/commands/agent/session-store.ts` - ä¼šè¯å­˜å‚¨æ›´æ–°

**å…³é”®æ¦‚å¿µ**:
- ä¼šè¯IDå’Œä¼šè¯Keyçš„åŒºåˆ«
- ä¼šè¯å¦‚ä½•è¢«åˆ›å»ºå’ŒæŸ¥æ‰¾
- ä¼šè¯çŠ¶æ€å¦‚ä½•æŒä¹…åŒ–

**å®è·µ**:
```bash
# åˆ›å»ºå¤šä¸ªä¼šè¯ï¼Œè§‚å¯Ÿä¼šè¯æ–‡ä»¶
pnpm moltbot agent --message "First" --session-id test1
pnpm moltbot agent --message "Second" --session-id test2
# æŸ¥çœ‹ä¼šè¯æ–‡ä»¶
ls ~/.clawdbot/sessions/
```

**æ£€æŸ¥ç‚¹**:
- [ ] ç†è§£ `resolveSession` å¦‚ä½•è§£æä¼šè¯
- [ ] ç†è§£ä¼šè¯æ–‡ä»¶çš„ç»“æ„
- [ ] ç†è§£ä¼šè¯å¦‚ä½•ä¸agentå…³è”

---

#### ç¬¬6å°æ—¶ï¼šå·¥å…·ç³»ç»Ÿ

**å­¦ä¹ æ–‡ä»¶**:
1. `src/agents/pi-tools.ts` - å·¥å…·å®šä¹‰å’Œæ³¨å†Œ
2. `src/agents/pi-tool-definition-adapter.ts` - å·¥å…·å®šä¹‰é€‚é…å™¨
3. `src/agents/clawdbot-tools.ts` - Moltbotå·¥å…·é›†åˆ

**å…³é”®æ¦‚å¿µ**:
- å·¥å…·å¦‚ä½•è¢«å®šä¹‰ï¼ˆschemaï¼‰
- å·¥å…·å¦‚ä½•è¢«æ³¨å†Œåˆ°Agent
- å·¥å…·è°ƒç”¨å¦‚ä½•è¢«æ‰§è¡Œ

**å®è·µ**:
```bash
# è®©agentä½¿ç”¨å·¥å…·
pnpm moltbot agent --message "Read the file package.json" --agent main
```

**æ£€æŸ¥ç‚¹**:
- [ ] ç†è§£å·¥å…·schemaçš„å®šä¹‰æ–¹å¼
- [ ] ç†è§£å·¥å…·å¦‚ä½•è¢«æš´éœ²ç»™Pi Agent
- [ ] ç†è§£å·¥å…·è°ƒç”¨çš„æ‰§è¡Œæµç¨‹

---

#### ç¬¬7å°æ—¶ï¼šæ¨¡å‹å’Œè®¤è¯

**å­¦ä¹ æ–‡ä»¶**:
1. `src/agents/model-selection.ts` - æ¨¡å‹é€‰æ‹©
2. `src/agents/model-catalog.ts` - æ¨¡å‹ç›®å½•
3. `src/agents/auth-profiles.ts` - è®¤è¯é…ç½®
4. `src/agents/model-fallback.ts` - æ¨¡å‹å›é€€

**å…³é”®æ¦‚å¿µ**:
- æ¨¡å‹å¦‚ä½•è¢«é€‰æ‹©å’Œè§£æ
- è®¤è¯é…ç½®å¦‚ä½•ç®¡ç†
- æ¨¡å‹å¤±è´¥æ—¶çš„å›é€€æœºåˆ¶

**å®è·µ**:
```bash
# æŸ¥çœ‹å¯ç”¨æ¨¡å‹
pnpm moltbot models list
# ä½¿ç”¨ç‰¹å®šæ¨¡å‹
pnpm moltbot agent --message "Hello" --model anthropic/claude-opus-4-5
```

**æ£€æŸ¥ç‚¹**:
- [ ] ç†è§£æ¨¡å‹IDçš„æ ¼å¼ï¼ˆ`provider/model`ï¼‰
- [ ] ç†è§£è®¤è¯é…ç½®çš„ä¼˜å…ˆçº§
- [ ] ç†è§£æ¨¡å‹å›é€€é€»è¾‘

---

#### ç¬¬8å°æ—¶ï¼šå®Œæ•´æµç¨‹è¿½è¸ª

**ä»»åŠ¡**: è¿½è¸ªä¸€ä¸ªå®Œæ•´çš„Agentè¯·æ±‚ä»CLIåˆ°å“åº”çš„å®Œæ•´æµç¨‹

**æ­¥éª¤**:
1. åœ¨ `src/cli/run-main.ts` çš„ `runCli` å‡½æ•°æ·»åŠ æ—¥å¿—
2. åœ¨ `src/commands/agent.ts` çš„ `agentCommand` æ·»åŠ æ—¥å¿—
3. åœ¨ `src/agents/pi-embedded-runner.ts` çš„ `runEmbeddedPiAgent` æ·»åŠ æ—¥å¿—
4. è¿è¡Œä¸€ä¸ªå‘½ä»¤ï¼Œè§‚å¯Ÿæ—¥å¿—è¾“å‡º

**å®è·µ**:
```bash
# æ·»åŠ è°ƒè¯•æ—¥å¿—åè¿è¡Œ
pnpm moltbot agent --message "Trace this request" --agent main --verbose full
```

**æ£€æŸ¥ç‚¹**:
- [ ] èƒ½å¤Ÿå®Œæ•´è¿½è¸ªä¸€ä¸ªè¯·æ±‚çš„æ‰§è¡Œè·¯å¾„
- [ ] ç†è§£æ¯ä¸ªå…³é”®èŠ‚ç‚¹çš„æ•°æ®æµè½¬
- [ ] ç†è§£é”™è¯¯å¦‚ä½•è¢«å¤„ç†å’Œä¼ æ’­

---

## æ·±å…¥å­¦ä¹ ï¼ˆ1å‘¨ï¼‰- æ¨¡å—ç»†èŠ‚

### ç›®æ ‡
æ·±å…¥ç†è§£æ¯ä¸ªæ¨¡å—çš„å®ç°ç»†èŠ‚ï¼Œèƒ½å¤Ÿä¿®æ”¹å’Œæ‰©å±•åŠŸèƒ½ã€‚

### æ¯æ—¥å­¦ä¹ è®¡åˆ’

#### ç¬¬1å¤©ï¼šCLIæ¡†æ¶æ·±å…¥

**å­¦ä¹ å†…å®¹**:
- CLIå‘½ä»¤æ³¨å†Œæœºåˆ¶
- å‚æ•°è§£æå’ŒéªŒè¯
- å­å‘½ä»¤ç³»ç»Ÿ
- æ’ä»¶å‘½ä»¤é›†æˆ

**é‡ç‚¹æ–‡ä»¶**:
- `src/cli/program/build-program.ts` - ç¨‹åºæ„å»º
- `src/cli/program/command-registry.ts` - å‘½ä»¤æ³¨å†Œ
- `src/cli/program/register.subclis.ts` - å­å‘½ä»¤æ³¨å†Œ
- `src/plugins/cli.ts` - æ’ä»¶å‘½ä»¤

**å®è·µä»»åŠ¡**:
1. é˜…è¯»æ‰€æœ‰CLIç›¸å…³çš„æµ‹è¯•æ–‡ä»¶
2. å°è¯•æ·»åŠ ä¸€ä¸ªæ–°çš„CLIå‘½ä»¤
3. ç†è§£å‘½ä»¤é€‰é¡¹çš„å®šä¹‰æ–¹å¼

**æ£€æŸ¥ç‚¹**:
- [ ] ç†è§£å‘½ä»¤æ³¨å†Œçš„å®Œæ•´æµç¨‹
- [ ] èƒ½å¤Ÿæ·»åŠ æ–°çš„CLIå‘½ä»¤
- [ ] ç†è§£å‚æ•°éªŒè¯æœºåˆ¶

---

#### ç¬¬2å¤©ï¼šAgentè¿è¡Œæ—¶æ·±å…¥

**å­¦ä¹ å†…å®¹**:
- Pi Agentçš„åµŒå…¥æœºåˆ¶
- RPCé€šä¿¡åè®®
- æµå¼å“åº”å¤„ç†
- å·¥å…·è°ƒç”¨æ¡¥æ¥

**é‡ç‚¹æ–‡ä»¶**:
- `src/agents/pi-embedded.ts` - åµŒå…¥å¼Agentä¸»å…¥å£
- `src/agents/pi-embedded-runner.ts` - Agentè¿è¡Œé€»è¾‘
- `src/agents/pi-embedded-subscribe.ts` - äº‹ä»¶è®¢é˜…
- `src/agents/pi-embedded-helpers.ts` - è¾…åŠ©å‡½æ•°

**å®è·µä»»åŠ¡**:
1. é˜…è¯»Pi Agentçš„RPCåè®®æ–‡æ¡£
2. ç†è§£æµå¼å“åº”çš„å¤„ç†æ–¹å¼
3. è¿½è¸ªä¸€ä¸ªå·¥å…·è°ƒç”¨çš„å®Œæ•´æµç¨‹

**æ£€æŸ¥ç‚¹**:
- [ ] ç†è§£Pi Agentçš„RPCåè®®
- [ ] ç†è§£æµå¼å“åº”çš„å¤„ç†æœºåˆ¶
- [ ] ç†è§£å·¥å…·è°ƒç”¨çš„æ¡¥æ¥æ–¹å¼

---

#### ç¬¬3å¤©ï¼šå·¥å…·ç³»ç»Ÿæ·±å…¥

**å­¦ä¹ å†…å®¹**:
- å·¥å…·å®šä¹‰å’Œschema
- å·¥å…·æ³¨å†Œæœºåˆ¶
- å·¥å…·è°ƒç”¨æ‰§è¡Œ
- å·¥å…·ç»“æœå¤„ç†

**é‡ç‚¹æ–‡ä»¶**:
- `src/agents/pi-tools.ts` - å·¥å…·å®šä¹‰
- `src/agents/pi-tool-definition-adapter.ts` - å·¥å…·é€‚é…å™¨
- `src/agents/clawdbot-tools.ts` - å·¥å…·é›†åˆ
- `src/gateway/tools/` - Gatewayå·¥å…·å®ç°

**å®è·µä»»åŠ¡**:
1. é˜…è¯»æ‰€æœ‰å·¥å…·çš„å®ç°
2. ç†è§£å·¥å…·schemaçš„å®šä¹‰æ–¹å¼
3. å°è¯•æ·»åŠ ä¸€ä¸ªæ–°çš„ç®€å•å·¥å…·

**æ£€æŸ¥ç‚¹**:
- [ ] ç†è§£å·¥å…·schemaçš„å®Œæ•´å®šä¹‰
- [ ] èƒ½å¤Ÿæ·»åŠ æ–°çš„å·¥å…·
- [ ] ç†è§£å·¥å…·è°ƒç”¨çš„å®‰å…¨è¾¹ç•Œ

---

#### ç¬¬4å¤©ï¼šä¼šè¯å’Œä¸Šä¸‹æ–‡ç®¡ç†

**å­¦ä¹ å†…å®¹**:
- ä¼šè¯ç”Ÿå‘½å‘¨æœŸ
- ä¸Šä¸‹æ–‡çª—å£ç®¡ç†
- ä¼šè¯å‹ç¼©
- å†å²è®°å½•ç®¡ç†

**é‡ç‚¹æ–‡ä»¶**:
- `src/agents/context.ts` - ä¸Šä¸‹æ–‡ç®¡ç†
- `src/agents/compaction.ts` - ä¼šè¯å‹ç¼©
- `src/agents/context-window-guard.ts` - ä¸Šä¸‹æ–‡çª—å£ä¿æŠ¤
- `src/config/sessions.ts` - ä¼šè¯å­˜å‚¨

**å®è·µä»»åŠ¡**:
1. ç†è§£ä¼šè¯å‹ç¼©çš„è§¦å‘æ¡ä»¶
2. ç†è§£ä¸Šä¸‹æ–‡çª—å£å¦‚ä½•è¢«ç®¡ç†
3. è¿½è¸ªä¸€ä¸ªé•¿ä¼šè¯çš„å¤„ç†æµç¨‹

**æ£€æŸ¥ç‚¹**:
- [ ] ç†è§£ä¼šè¯å‹ç¼©æœºåˆ¶
- [ ] ç†è§£ä¸Šä¸‹æ–‡çª—å£ç®¡ç†
- [ ] ç†è§£å†å²è®°å½•çš„å­˜å‚¨æ–¹å¼

---

#### ç¬¬5å¤©ï¼šæ¨¡å‹å’Œè®¤è¯ç³»ç»Ÿ

**å­¦ä¹ å†…å®¹**:
- æ¨¡å‹å‘ç°å’Œé€‰æ‹©
- è®¤è¯é…ç½®ç®¡ç†
- æ¨¡å‹å›é€€æœºåˆ¶
- è®¤è¯profileè½®æ¢

**é‡ç‚¹æ–‡ä»¶**:
- `src/agents/model-catalog.ts` - æ¨¡å‹ç›®å½•
- `src/agents/model-selection.ts` - æ¨¡å‹é€‰æ‹©
- `src/agents/model-fallback.ts` - æ¨¡å‹å›é€€
- `src/agents/auth-profiles.ts` - è®¤è¯é…ç½®
- `src/agents/auth-profiles/` - è®¤è¯é…ç½®å®ç°

**å®è·µä»»åŠ¡**:
1. ç†è§£æ¨¡å‹å‘ç°çš„æœºåˆ¶
2. ç†è§£è®¤è¯é…ç½®çš„ä¼˜å…ˆçº§
3. ç†è§£æ¨¡å‹å›é€€çš„è§¦å‘æ¡ä»¶

**æ£€æŸ¥ç‚¹**:
- [ ] ç†è§£æ¨¡å‹å‘ç°çš„å®Œæ•´æµç¨‹
- [ ] ç†è§£è®¤è¯é…ç½®çš„ç®¡ç†æ–¹å¼
- [ ] ç†è§£æ¨¡å‹å›é€€çš„é€»è¾‘

---

#### ç¬¬6å¤©ï¼šGatewayé›†æˆæ·±å…¥

**å­¦ä¹ å†…å®¹**:
- WebSocketè¿æ¥ç®¡ç†
- Gatewayåè®®å®ç°
- è¯·æ±‚/å“åº”å¤„ç†
- äº‹ä»¶è®¢é˜…æœºåˆ¶

**é‡ç‚¹æ–‡ä»¶**:
- `src/gateway/call.ts` - Gatewayè°ƒç”¨
- `src/gateway/protocol/` - åè®®å®šä¹‰
- `src/gateway/server-methods/agent.ts` - Agentæ–¹æ³•å®ç°
- `src/cli/gateway-rpc.ts` - RPCå®¢æˆ·ç«¯

**å®è·µä»»åŠ¡**:
1. ç†è§£Gatewayåè®®çš„å®Œæ•´å®šä¹‰
2. ç†è§£WebSocketè¿æ¥çš„ç”Ÿå‘½å‘¨æœŸ
3. ç†è§£äº‹ä»¶è®¢é˜…æœºåˆ¶

**æ£€æŸ¥ç‚¹**:
- [ ] ç†è§£Gatewayåè®®çš„å®Œæ•´å®ç°
- [ ] ç†è§£WebSocketè¿æ¥ç®¡ç†
- [ ] ç†è§£äº‹ä»¶è®¢é˜…æœºåˆ¶

---

#### ç¬¬7å¤©ï¼šç»¼åˆå®è·µå’Œæµ‹è¯•

**å­¦ä¹ å†…å®¹**:
- æµ‹è¯•å¥—ä»¶ç»“æ„
- å•å…ƒæµ‹è¯•ç¼–å†™
- E2Eæµ‹è¯•ç†è§£
- è°ƒè¯•æŠ€å·§

**é‡ç‚¹æ–‡ä»¶**:
- `src/commands/agent.test.ts` - Agentå‘½ä»¤æµ‹è¯•
- `src/agents/pi-embedded-runner.test.ts` - Agentè¿è¡Œæµ‹è¯•
- `src/commands/agent-via-gateway.test.ts` - Gateway Agentæµ‹è¯•

**å®è·µä»»åŠ¡**:
1. é˜…è¯»æ‰€æœ‰ç›¸å…³æµ‹è¯•æ–‡ä»¶
2. è¿è¡Œæµ‹è¯•å¥—ä»¶
3. å°è¯•ç¼–å†™ä¸€ä¸ªæ–°çš„æµ‹è¯•ç”¨ä¾‹
4. ä¿®å¤ä¸€ä¸ªç®€å•çš„bugæˆ–æ·»åŠ ä¸€ä¸ªå°åŠŸèƒ½

**æ£€æŸ¥ç‚¹**:
- [ ] ç†è§£æµ‹è¯•å¥—ä»¶çš„ç»“æ„
- [ ] èƒ½å¤Ÿç¼–å†™æ–°çš„æµ‹è¯•ç”¨ä¾‹
- [ ] èƒ½å¤Ÿè°ƒè¯•å’Œä¿®å¤é—®é¢˜

---

## å…³é”®ä»£ç æ–‡ä»¶é€ŸæŸ¥

### CLIç›¸å…³
- `moltbot.mjs` - CLIå…¥å£
- `src/cli/run-main.ts` - CLIä¸»å‡½æ•°
- `src/cli/program.ts` - ç¨‹åºæ„å»º
- `src/cli/program/command-registry.ts` - å‘½ä»¤æ³¨å†Œ
- `src/cli/program/build-program.ts` - ç¨‹åºæ„å»ºå®ç°

### Agentç›¸å…³
- `src/commands/agent.ts` - Agentå‘½ä»¤ä¸»å‡½æ•°
- `src/commands/agent-via-gateway.ts` - Gateway Agentè°ƒç”¨
- `src/agents/pi-embedded.ts` - åµŒå…¥å¼Agentå…¥å£
- `src/agents/pi-embedded-runner.ts` - Agentè¿è¡Œé€»è¾‘
- `src/agents/pi-embedded-subscribe.ts` - äº‹ä»¶è®¢é˜…

### å·¥å…·ç›¸å…³
- `src/agents/pi-tools.ts` - å·¥å…·å®šä¹‰
- `src/agents/clawdbot-tools.ts` - å·¥å…·é›†åˆ
- `src/agents/pi-tool-definition-adapter.ts` - å·¥å…·é€‚é…å™¨

### ä¼šè¯ç›¸å…³
- `src/commands/agent/session.ts` - ä¼šè¯è§£æ
- `src/config/sessions.ts` - ä¼šè¯å­˜å‚¨
- `src/agents/context.ts` - ä¸Šä¸‹æ–‡ç®¡ç†

### æ¨¡å‹ç›¸å…³
- `src/agents/model-selection.ts` - æ¨¡å‹é€‰æ‹©
- `src/agents/model-catalog.ts` - æ¨¡å‹ç›®å½•
- `src/agents/auth-profiles.ts` - è®¤è¯é…ç½®

### Gatewayç›¸å…³
- `src/gateway/call.ts` - Gatewayè°ƒç”¨
- `src/gateway/protocol/` - åè®®å®šä¹‰
- `src/cli/gateway-rpc.ts` - RPCå®¢æˆ·ç«¯

---

## è°ƒè¯•æŠ€å·§

### 1. å¯ç”¨è¯¦ç»†æ—¥å¿—
```bash
# åœ¨ä»£ç ä¸­æ·»åŠ æ—¥å¿—
console.log('[DEBUG]', ...)

# ä½¿ç”¨verboseæ¨¡å¼
pnpm moltbot agent --message "test" --verbose full
```

### 2. ä½¿ç”¨æ–­ç‚¹
åœ¨VS Codeä¸­è®¾ç½®æ–­ç‚¹ï¼Œä½¿ç”¨è°ƒè¯•å™¨è¿½è¸ªæ‰§è¡Œæµç¨‹ã€‚

### 3. æŸ¥çœ‹æµ‹è¯•ç”¨ä¾‹
æµ‹è¯•ç”¨ä¾‹æ˜¯æœ€å¥½çš„æ–‡æ¡£ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨APIã€‚

### 4. è¿½è¸ªæ‰§è¡Œè·¯å¾„
åœ¨å…³é”®å‡½æ•°å…¥å£å’Œå‡ºå£æ·»åŠ æ—¥å¿—ï¼Œè¿½è¸ªæ•°æ®æµè½¬ã€‚

---

## å¸¸è§é—®é¢˜

### Q: Agentå‘½ä»¤çš„ä¸¤ç§æ‰§è¡Œæ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
A: 
- **æœ¬åœ°æ¨¡å¼** (`--local`): ç›´æ¥åœ¨CLIè¿›ç¨‹ä¸­è¿è¡ŒPi Agentï¼Œä¸é€šè¿‡Gateway
- **Gatewayæ¨¡å¼** (é»˜è®¤): é€šè¿‡WebSocketè¿æ¥åˆ°Gatewayï¼Œç”±Gatewayæ‰§è¡ŒAgent

### Q: å¦‚ä½•ç†è§£ä¼šè¯Keyå’Œä¼šè¯IDï¼Ÿ
A:
- **ä¼šè¯ID**: ç”¨æˆ·æŒ‡å®šçš„ä¼šè¯æ ‡è¯†ç¬¦ï¼ˆå¦‚ `test1`ï¼‰
- **ä¼šè¯Key**: ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨çš„å®Œæ•´ä¼šè¯æ ‡è¯†ç¬¦ï¼ˆå¦‚ `main:test1`ï¼‰ï¼ŒåŒ…å«agent ID

### Q: å·¥å…·è°ƒç”¨æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ
A:
1. Agentè¯·æ±‚å·¥å…·è°ƒç”¨
2. Pi Agentè¿è¡Œæ—¶æ¥æ”¶å·¥å…·è°ƒç”¨è¯·æ±‚
3. é€šè¿‡å·¥å…·é€‚é…å™¨è½¬æ¢ä¸ºGatewayå·¥å…·è°ƒç”¨
4. Gatewayæ‰§è¡Œå·¥å…·å¹¶è¿”å›ç»“æœ
5. ç»“æœè¿”å›ç»™Agentç»§ç»­å¤„ç†

### Q: å¦‚ä½•æ·»åŠ æ–°çš„å·¥å…·ï¼Ÿ
A:
1. åœ¨ `src/gateway/tools/` ä¸­å®ç°å·¥å…·é€»è¾‘
2. åœ¨ `src/agents/clawdbot-tools.ts` ä¸­æ³¨å†Œå·¥å…·
3. å®šä¹‰å·¥å…·schema
4. ç¼–å†™æµ‹è¯•ç”¨ä¾‹

---

## ä¸‹ä¸€æ­¥

å®Œæˆå­¦ä¹ åï¼Œå»ºè®®ï¼š
1. **é˜…è¯»ç›¸å…³æ–‡æ¡£**: `docs/concepts/agent.md`, `docs/concepts/agent-loop.md`
2. **æŸ¥çœ‹æµ‹è¯•ç”¨ä¾‹**: ç†è§£å„ç§ä½¿ç”¨åœºæ™¯
3. **å‚ä¸å¼€å‘**: ä¿®å¤bugæˆ–æ·»åŠ æ–°åŠŸèƒ½
4. **è´¡çŒ®ä»£ç **: æäº¤PRæ”¹è¿›ä»£ç 

ç¥å­¦ä¹ é¡ºåˆ©ï¼ğŸ¦
